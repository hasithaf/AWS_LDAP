###  Coding Challenge

```
ansible-playbook addgroup.yml -i hosts
```


```
PLAY ***************************************************************************

TASK [setup] *******************************************************************
ok: [54.213.43.28]

TASK [create group techops_dba] ************************************************
ok: [54.213.43.28]

TASK [print /etc/group] ********************************************************
changed: [54.213.43.28]

TASK [debug] *******************************************************************
ok: [54.213.43.28] => {
    "msg": [
        "root:x:0:", 
        "bin:x:1:", 
        "daemon:x:2:", 
        "sys:x:3:", 
        "adm:x:4:ec2-user", 
        "tty:x:5:", 
        "disk:x:6:", 
        "lp:x:7:", 
        "mem:x:8:", 
        "kmem:x:9:", 
        "wheel:x:10:ec2-user", 
        "cdrom:x:11:", 
        "mail:x:12:postfix", 
        "man:x:15:", 
        "dialout:x:18:", 
        "floppy:x:19:", 
        "games:x:20:", 
        "tape:x:30:", 
        "video:x:39:", 
        "ftp:x:50:", 
        "lock:x:54:", 
        "audio:x:63:", 
        "nobody:x:99:", 
        "users:x:100:", 
        "avahi-autoipd:x:170:", 
        "utmp:x:22:", 
        "utempter:x:35:", 
        "ssh_keys:x:999:", 
        "input:x:998:", 
        "systemd-journal:x:190:ec2-user", 
        "systemd-bus-proxy:x:997:", 
        "systemd-network:x:996:", 
        "dbus:x:81:", 
        "polkitd:x:995:", 
        "tss:x:59:", 
        "dip:x:40:", 
        "cgred:x:994:", 
        "postdrop:x:90:", 
        "postfix:x:89:", 
        "chrony:x:993:", 
        "sshd:x:74:", 
        "ec2-user:x:1000:", 
        "rpc:x:32:", 
        "ldap:x:55:", 
        "rpcuser:x:29:", 
        "nfsnobody:x:65534:", 
        "ntp:x:38:", 
        "techops_dba:x:1001:"
    ]
}

TASK [add techops_dba to /etc/security/access.conf] ****************************
ok: [54.213.43.28] => (item=# This will add "techops_dba" with all privileges)
ok: [54.213.43.28] => (item=+ : @techops_dba : ALL)

TASK [print /etc/security/access.conf] *****************************************
changed: [54.213.43.28]

TASK [debug] *******************************************************************
ok: [54.213.43.28] => {
    "msg": [
        "# Login access control table.", 
        "#", 
        "# Comment line must start with \"#\", no space at front.", 
        "# Order of lines is important.", 
        "#", 
        "# When someone logs in, the table is scanned for the first entry that", 
        "# matches the (user, host) combination, or, in case of non-networked", 
        "# logins, the first entry that matches the (user, tty) combination.  The", 
        "# permissions field of that table entry determines whether the login will", 
        "# be accepted or refused.", 
        "#", 
        "# Format of the login access control table is three fields separated by a", 
        "# \":\" character:", 
        "#", 
        "# [Note, if you supply a 'fieldsep=|' argument to the pam_access.so", 
        "# module, you can change the field separation character to be", 
        "# '|'. This is useful for configurations where you are trying to use", 
        "# pam_access with X applications that provide PAM_TTY values that are", 
        "# the display variable like \"host:0\".]", 
        "#", 
        "# \tpermission : users : origins", 
        "#", 
        "# The first field should be a \"+\" (access granted) or \"-\" (access denied)", 
        "# character.", 
        "#", 
        "# The second field should be a list of one or more login names, group", 
        "# names, or ALL (always matches). A pattern of the form user@host is", 
        "# matched when the login name matches the \"user\" part, and when the", 
        "# \"host\" part matches the local machine name.", 
        "#", 
        "# The third field should be a list of one or more tty names (for", 
        "# non-networked logins), host names, domain names (begin with \".\"), host", 
        "# addresses, internet network numbers (end with \".\"), ALL (always", 
        "# matches), NONE (matches no tty on non-networked logins) or", 
        "# LOCAL (matches any string that does not contain a \".\" character).", 
        "#", 
        "# You can use @netgroupname in host or user patterns; this even works", 
        "# for @usergroup@@hostgroup patterns.", 
        "#", 
        "# The EXCEPT operator makes it possible to write very compact rules.", 
        "#", 
        "# The group file is searched only when a name does not match that of the", 
        "# logged-in user. Both the user's primary group is matched, as well as", 
        "# groups in which users are explicitly listed.", 
        "# To avoid problems with accounts, which have the same name as a group,", 
        "# you can use brackets around group names '(group)' to differentiate.", 
        "# In this case, you should also set the \"nodefgroup\" option.", 
        "#", 
        "# TTY NAMES: Must be in the form returned by ttyname(3) less the initial", 
        "# \"/dev\" (e.g. tty1 or vc/1)", 
        "#", 
        "##############################################################################", 
        "#", 
        "# Disallow non-root logins on tty1", 
        "#", 
        "#-:ALL EXCEPT root:tty1", 
        "#", 
        "# Disallow console logins to all but a few accounts.", 
        "#", 
        "#-:ALL EXCEPT wheel shutdown sync:LOCAL", 
        "#", 
        "# Same, but make sure that really the group wheel and not the user", 
        "# wheel is used (use nodefgroup argument, too):", 
        "#", 
        "#-:ALL EXCEPT (wheel) shutdown sync:LOCAL", 
        "#", 
        "# Disallow non-local logins to privileged accounts (group wheel).", 
        "#", 
        "#-:wheel:ALL EXCEPT LOCAL .win.tue.nl", 
        "#", 
        "# Some accounts are not allowed to login from anywhere:", 
        "#", 
        "#-:wsbscaro wsbsecr wsbspac wsbsym wscosor wstaiwde:ALL", 
        "#", 
        "# All other accounts are allowed to login from anywhere.", 
        "#", 
        "##############################################################################", 
        "# All lines from here up to the end are building a more complex example.", 
        "##############################################################################", 
        "#", 
        "# User \"root\" should be allowed to get access via cron .. tty5 tty6.", 
        "#+ : root : cron crond :0 tty1 tty2 tty3 tty4 tty5 tty6", 
        "#", 
        "# User \"root\" should be allowed to get access from hosts with ip addresses.", 
        "#+ : root : 192.168.200.1 192.168.200.4 192.168.200.9", 
        "#+ : root : 127.0.0.1", 
        "#", 
        "# User \"root\" should get access from network 192.168.201.", 
        "# This term will be evaluated by string matching.", 
        "# comment: It might be better to use network/netmask instead.", 
        "#          The same is 192.168.201.0/24 or 192.168.201.0/255.255.255.0", 
        "#+ : root : 192.168.201.", 
        "#", 
        "# User \"root\" should be able to have access from domain.", 
        "# Uses string matching also.", 
        "#+ : root : .foo.bar.org", 
        "#", 
        "# User \"root\" should be denied to get access from all other sources.", 
        "#- : root : ALL", 
        "#", 
        "# User \"foo\" and members of netgroup \"nis_group\" should be", 
        "# allowed to get access from all sources.", 
        "# This will only work if netgroup service is available.", 
        "#+ : @nis_group foo : ALL", 
        "#", 
        "# User \"john\" should get access from ipv4 net/mask", 
        "#+ : john : 127.0.0.0/24", 
        "#", 
        "# User \"john\" should get access from ipv4 as ipv6 net/mask", 
        "#+ : john : ::ffff:127.0.0.0/127", 
        "#", 
        "# User \"john\" should get access from ipv6 host address", 
        "#+ : john : 2001:4ca0:0:101::1", 
        "#", 
        "# User \"john\" should get access from ipv6 host address (same as above)", 
        "#+ : john : 2001:4ca0:0:101:0:0:0:1", 
        "#", 
        "# User \"john\" should get access from ipv6 net/mask", 
        "#+ : john : 2001:4ca0:0:101::/64", 
        "#", 
        "# All other users should be denied to get access from all sources.", 
        "#- : ALL : ALL", 
        "# This will add \"techops_dba\" with all privileges", 
        "+ : @techops_dba : ALL"
    ]
}

TASK [set /etc/sudoers permission to 640] **************************************
changed: [54.213.43.28]

TASK [add techops_dba to /etc/sudoers] *****************************************
changed: [54.213.43.28] => (item=## Allows people in group techops_dba to run all commands)
ok: [54.213.43.28] => (item=%techops_dba	ALL=(ALL) 	ALL)

TASK [set /etc/sudoers permission back to 440] *********************************
changed: [54.213.43.28]

TASK [print /etc/sudoers] ******************************************************
changed: [54.213.43.28]

TASK [debug] *******************************************************************
ok: [54.213.43.28] => {
    "msg": [
        "## Sudoers allows particular users to run various commands as", 
        "## the root user, without needing the root password.", 
        "##", 
        "## Examples are provided at the bottom of the file for collections", 
        "## of related commands, which can then be delegated out to particular", 
        "## users or groups.", 
        "## ", 
        "## This file must be edited with the 'visudo' command.", 
        "", 
        "## Host Aliases", 
        "## Groups of machines. You may prefer to use hostnames (perhaps using ", 
        "## wildcards for entire domains) or IP addresses instead.", 
        "# Host_Alias     FILESERVERS = fs1, fs2", 
        "# Host_Alias     MAILSERVERS = smtp, smtp2", 
        "", 
        "## User Aliases", 
        "## These aren't often necessary, as you can use regular groups", 
        "## (ie, from files, LDAP, NIS, etc) in this file - just use %groupname ", 
        "## rather than USERALIAS", 
        "# User_Alias ADMINS = jsmith, mikem", 
        "", 
        "", 
        "## Command Aliases", 
        "## These are groups of related commands...", 
        "", 
        "## Networking", 
        "# Cmnd_Alias NETWORKING = /sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dhclient, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial, /sbin/iwconfig, /sbin/mii-tool", 
        "", 
        "## Installation and management of software", 
        "# Cmnd_Alias SOFTWARE = /bin/rpm, /usr/bin/up2date, /usr/bin/yum", 
        "", 
        "## Services", 
        "# Cmnd_Alias SERVICES = /sbin/service, /sbin/chkconfig, /usr/bin/systemctl start, /usr/bin/systemctl stop, /usr/bin/systemctl reload, /usr/bin/systemctl restart, /usr/bin/systemctl status, /usr/bin/systemctl enable, /usr/bin/systemctl disable", 
        "", 
        "## Updating the locate database", 
        "# Cmnd_Alias LOCATE = /usr/bin/updatedb", 
        "", 
        "## Storage", 
        "# Cmnd_Alias STORAGE = /sbin/fdisk, /sbin/sfdisk, /sbin/parted, /sbin/partprobe, /bin/mount, /bin/umount", 
        "", 
        "## Delegating permissions", 
        "# Cmnd_Alias DELEGATING = /usr/sbin/visudo, /bin/chown, /bin/chmod, /bin/chgrp ", 
        "", 
        "## Processes", 
        "# Cmnd_Alias PROCESSES = /bin/nice, /bin/kill, /usr/bin/kill, /usr/bin/killall", 
        "", 
        "## Drivers", 
        "# Cmnd_Alias DRIVERS = /sbin/modprobe", 
        "", 
        "# Defaults specification", 
        "", 
        "#", 
        "# Disable \"ssh hostname sudo <cmd>\", because it will show the password in clear. ", 
        "#         You have to run \"ssh -t hostname sudo <cmd>\".", 
        "#", 
        "Defaults    requiretty", 
        "", 
        "#", 
        "# Refuse to run if unable to disable echo on the tty. This setting should also be", 
        "# changed in order to be able to use sudo without a tty. See requiretty above.", 
        "#", 
        "Defaults   !visiblepw", 
        "", 
        "#", 
        "# Preserving HOME has security implications since many programs", 
        "# use it when searching for configuration files. Note that HOME", 
        "# is already set when the the env_reset option is enabled, so", 
        "# this option is only effective for configurations where either", 
        "# env_reset is disabled or HOME is present in the env_keep list.", 
        "#", 
        "Defaults    always_set_home", 
        "", 
        "Defaults    env_reset", 
        "Defaults    env_keep =  \"COLORS DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS\"", 
        "Defaults    env_keep += \"MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE\"", 
        "Defaults    env_keep += \"LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES\"", 
        "Defaults    env_keep += \"LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE\"", 
        "Defaults    env_keep += \"LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY\"", 
        "", 
        "#", 
        "# Adding HOME to env_keep may enable a user to run unrestricted", 
        "# commands via sudo.", 
        "#", 
        "# Defaults   env_keep += \"HOME\"", 
        "", 
        "Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin", 
        "", 
        "## Next comes the main part: which users can run what software on ", 
        "## which machines (the sudoers file can be shared between multiple", 
        "## systems).", 
        "## Syntax:", 
        "##", 
        "## \tuser\tMACHINE=COMMANDS", 
        "##", 
        "## The COMMANDS section may have other options added to it.", 
        "##", 
        "## Allow root to run any commands anywhere ", 
        "root\tALL=(ALL) \tALL", 
        "", 
        "## Allows members of the 'sys' group to run networking, software, ", 
        "## service management apps and more.", 
        "# %sys ALL = NETWORKING, SOFTWARE, SERVICES, STORAGE, DELEGATING, PROCESSES, LOCATE, DRIVERS", 
        "", 
        "## Allows people in group wheel to run all commands", 
        "%wheel\tALL=(ALL)\tALL", 
        "", 
        "## Same thing without a password", 
        "# %wheel\tALL=(ALL)\tNOPASSWD: ALL", 
        "", 
        "## Allows members of the users group to mount and unmount the ", 
        "## cdrom as root", 
        "# %users  ALL=/sbin/mount /mnt/cdrom, /sbin/umount /mnt/cdrom", 
        "", 
        "## Allows members of the users group to shutdown this system", 
        "# %users  localhost=/sbin/shutdown -h now", 
        "", 
        "## Read drop-in files from /etc/sudoers.d (the # here does not mean a comment)", 
        "#includedir /etc/sudoers.d", 
        "ec2-user\tALL=(ALL)\tNOPASSWD: ALL", 
        "## Allows people in group techops_dba to run all commands"
        "%techops_dba\tALL=(ALL) \tALL", 
    ]
}

PLAY RECAP *********************************************************************
54.213.43.28               : ok=12   changed=6    unreachable=0    failed=0   
```
